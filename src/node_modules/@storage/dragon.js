import { Factory } from "@factory/Factory";
import { writable,get } from 'svelte/store';

const FactoryClass = new Factory();
//FOR BREEDING
export const dragonA = writable(0);
export const dragonB = writable(0);

//USER DRAGONS ARRAY
export const userDragons = writable([]);

export function modify(){
    
    let currentDragons = get(userDragons)
    currentDragons[0].offer = false;
    userDragons.set(currentDragons)

    return 
}

export function getUserDragons(){    
    return get(userDragons)
}

export async function setUserDragons(dragons){

    let dragonArray = [];
    dragons.forEach((dragon) => {
        dragonArray.push(user_format(dragon))
    });
    
    userDragons.set(dragonArray)
}

export function update_current_dragon(dragon,_gender){
    
    dragon.gender = _gender
    if(_gender == 'dad'){
        dragonA.update(value => {
            value = dragon
            return value;
        });   
    }

    if(_gender == 'mum'){
        dragonB.update(value => {
            value = dragon
            return value;
        }); 
    }   
}

export function offer_format(dragon){

    const dragonObj = {
        id: dragon.id,
        dna: FactoryClass.dnaFromGenes(dragon.genes),
        gen: dragon.generation,
        mumId:dragon.mumId,
        dadId:dragon.dadId,
        single:true,
        displayOffer:true,
        displayDna:true,
        displayInfo:false,
        displayAttributes:false,
    };

    return dragonObj

}

export function user_format(dragon){
    
    const dragonObj = {
        id: dragon.id,
        dna: FactoryClass.dnaFromGenes(dragon.genes),
        gen: dragon.gen,
        offer: dragon.offer,
        isApprovedForAll: dragon.isApprovedForAll,
        isOwner : true,	
        displayDna:true,
        displayInfo:true,
        displayAttributes:true,
    };

    return dragonObj

}

export function marketplace_format(dragon) {

    const dragonObj = {
        id: dragon.tokenId,
        dna: FactoryClass.dnaFromGenes(dragon.genes),
        gen: dragon.generation,
        displayDna: true,
        displayInfo: true,
        displayAttributes: true,
    };

    return dragonObj;
}

export function factory_format(dragon){

    const dragonObj = {
        id: dragon.id,
        dna: dragon.dna,
        gen: dragon.gen,
        displayDna:true,
        displayInfo:false,
        displayAttributes:false,
    };

    return dragonObj

}
