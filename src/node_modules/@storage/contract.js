import { writable } from 'svelte/store';
import { contractsAbi } from "@contracts/contractsAbi";
//old
// 0x996693a83BCe641A3ac6A092A0f66020BCDb5574
export const dragonContract = "0xAc150fa7889E4FCEc6348a2BE4a1A50a9b0aA8aC";
//old
// 0x98a11542C588b14912A522B6afC17e9678cC8f9f
export const marketplaceAddress = "0x796796e9C27Cf75d28C86560f27DBf1c96a796aB";

export const balances = writable({ contract: 0,user: 0 });

export const contractInfo = async () => {
    
    const web3 = await Moralis.Web3.enable();
    let account = web3.currentProvider.selectedAddress;

    let dragon_instance = new web3.eth.Contract(contractsAbi.dragonToken, dragonContract, {
        from: account,
    });

    let marketplace_instance = new web3.eth.Contract(contractsAbi.marketplace, marketplaceAddress, {
        from: account,
    });

    let interfaces = {
        dragon:dragon_instance,
        marketplace: marketplace_instance
    }
    
    let contractData = {              
        account: account,
        interfaces : interfaces
    } 
    return contractData

}

export const updateBalances = async (dappBalance,userBalance) => {

    balances.update(value =>{
        value = { contract: dappBalance,user: userBalance }      
        return value
    }  )  

}